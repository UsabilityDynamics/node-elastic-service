<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/elastic-client.js - Elastic Client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://a3d72a45d111006ec192-ec5b80a12b0b09b4d52373336afb4254.r80.cf1.rackcdn.com/usability-dynamics.png" title="Elastic Client"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Index.html">Index</a></li>
            
                <li><a href="../classes/Type.html">Type</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/elastic-client.html">elastic-client</a></li>
            
                <li><a href="../modules/ElasticClient.html">ElasticClient</a></li>
            
                <li><a href="../modules/Index.html">Index</a></li>
            
                <li><a href="../modules/Type.html">Type</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/elastic-client.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Elastic Client
 *
 * @module ElasticClient
 * @constructor
 * @async
 * @chainable
 *
 * @author potanin@UD
 * @date 7/4/13
 *
 * @param options {Object} Client settings.
 * @param options.node.name {String} Name of instance.
 * @param options.cluster.name {String} Name of cluster for instance.
 * @param options.network.publish_host {String} Hostname of instance.
 * @param options.http.port {Number} Port of instance.
 * @param options.index.number_of_shards {Number} Number of shards.
 * @param options.index.number_of_replicas {Number} Number of replicas.
 *
 * @returns {Object} New ElasticClient instance.
 */
function ElasticClient( options ) {
  // ElasticClient.logger.debug( &#x27;Starting.&#x27; );

  // Modules
  var _ = require( &#x27;lodash&#x27; );
  var fs = require( &#x27;fs&#x27; );
  var Observe = require( &#x27;observe.io&#x27; );

  // Create Instance Properties for Main Module
  var Instance = Object.create( ElasticClient.prototype, {
    pid: {
      value: undefined,
      enumerable: false,
      writable: true
    },
    settings: {
      value: ElasticClient.utility.defaults( options || {}, ElasticClient._defaults || {} ),
      enumerable: false,
      writable: true
    },
    client: {
      value: new ( require( &#x27;elastical&#x27; ) ).Client( this.get( &#x27;host&#x27; ), {
        port: this.get( &#x27;port&#x27; ),
        protocol: this.get( &#x27;protocol&#x27; ),
        timeout: 60000,
        auth: false
      }),
      enumerable: false,
      writable: true
    },
    args: {
      value: [ &#x27;-f&#x27; ],
      enumerable: false,
      writable: true
    },
    Document: {
      /**
       * Get / Update or create a Document
       *
       * @async
       * @chainable
       */
      value: require( &#x27;./document&#x27; ),
      configurable: false,
      enumerable: true,
      writable: false
    },
    Index: {
      /**
       * Get / Update or create an Index
       *
       * @async
       * @chainable
       */
      value: require( &#x27;./index&#x27; ),
      configurable: false,
      enumerable: true,
      writable: false
    },
    Type: {
      /**
       * Type Actions
       *
       * @async
       * @chainable
       */
      value: require( &#x27;./type&#x27; ),
      configurable: false,
      enumerable: true,
      writable: false
    },
    search: {
      /**
       * Search Documents
       *
       */
      value: function search() {
        this.client.search.apply( this, arguments );
        return this;
      },
      enumerable: true,
      writable: true
    },
    bulk: {
      /**
       * Bulk Actions
       *
       */
      value: function bulk() {
        this.client.bulk.apply( this.client, arguments );
        return this;
      },
      enumerable: true,
      writable: true
    },
    get: {
      /**
       * Get Setting
       *
       * @return {} Setting value;
       * @async
       */
      value: function get( key ) {

        // Delo hostame. Just because.
        key = key || &#x27;hostame&#x27;;

        var options = this.settings || {};

        // Helper for Hostname lookup
        if( key === &#x27;host&#x27; ) {

          if( options[ &#x27;network.publish_host&#x27; ] ) {
            key = &#x27;network.publish_host&#x27;;
          }

        }

        // Helper for port lookup
        if( key === &#x27;port&#x27; ) {

          if( options[ &#x27;http.port&#x27; ] ) {
            key = &#x27;http.port&#x27;;
          }

        }

        return options[ key ] || null;

      },
      configurable: false,
      writable: false,
      enumerable: true
    },
    set: {
      /**
       * Set an Option / Options
       *
       * @param key {String}
       * @param value {Any}
       * @return {Object} Instance.
       * @chainable
       */
      value: function set( key, value ) {

        // Create Container
        this.settings = ElasticClient.utility.defaults( this.settings, ElasticClient._defaults );

        // Set Key-Value
        if( &#x27;string&#x27; === typeof key ) {
          this.settings[ key ] = value ? value : this.settings[ key ] || undefined;
        }

        // Extend Options using Object
        if( &#x27;object&#x27; === typeof key ) {
          ElasticClient.utility.extend( this.settings, key );
        }

        // Instance
        return this;

      },
      configurable: false,
      writable: false,
      enumerable: true
    },
    stop: {
      /**
       * Shutdown Instance
       *
       * @chainable
       * @async
       */
      value: function stop() {

        // Kill the process
        process.kill( this.pid );

        // Remove from Instance Pool
        delete ElasticClient._data.instances[ this.pid ];

        // Emit Event
        this.emit( &#x27;node.stopped&#x27; );

        // Return Instance
        return this;

      },
      configurable: false,
      writable: false,
      enumerable: true
    }
  });

  // Add Emitter functionality to Instance
  var Emitter = Observe.Emitter.create( arguments.callee.name, {
    delimiter: &#x27;.&#x27;,
    maxListeners: 100
  });

  Observe.utility.inherit( Instance, Observe.Emitter.prototype );

  console.log( Emitter.emit );

  // Monitor successful start
  Instance.once( &#x27;node.started&#x27;, function( error, report ) {
    ElasticClient.logger.debug( &#x27;Node started with pid [%s]&#x27;, this.pid );
    ElasticClient._data.instances[ this.pid ] = this;
  })

  // Start Instance
  ElasticClient.async.auto({
    // Validate and Prepare Options
    options: [ function options( next, report ) {

      try {

        if( Instance.settings[ &#x27;path.data&#x27; ] ) {
          Instance.settings[ &#x27;path.data&#x27; ] = fs.realpathSync( Instance.settings[ &#x27;path.data&#x27; ] );
        }

        if( Instance.settings[ &#x27;path.work&#x27; ] ) {
          Instance.settings[ &#x27;path.work&#x27; ] = fs.realpathSync( Instance.settings[ &#x27;path.work&#x27; ] );
        }

        if( Instance.settings[ &#x27;path.logs&#x27; ] ) {
          Instance.settings[ &#x27;path.logs&#x27; ] = fs.realpathSync( Instance.settings[ &#x27;path.logs&#x27; ] );
        }

      } catch( error ) { return next( error ); }

      next( null, Instance.settings );

    }],
    // Find Executable Path
    path: [ &#x27;options&#x27;, function path( next, report ) {

      // If path to ES is specified, resolve and return
      if( report.options.path &amp;&amp; fs.existsSync( report.options.path ) ) {
        return next( null, fs.realpathSync( report.options.path ) )
      };

      // Try to find global instance
      require( &#x27;which&#x27; )( &#x27;elasticsearch&#x27;, function which( error, found_path ) {
        next( error, found_path );
      });

      // Failure
      next( new Error( &#x27;ElasticSearch path not specified.&#x27; ) );

    }],
    // Spawn Process, &quot;pipe&quot; Events
    process: [ &#x27;path&#x27;, function process( next, report ) {

      // Command Arguments.
      Object.keys( report.options ).forEach( function( key ) {
        Instance.args.push( [ &#x27;-Des.&#x27;, key, &#x27;=&#x27;, report.options[ key ] ].join( &#x27;&#x27; ) );
      });

      // Spawn process and bind listeners
      report.process = require( &#x27;child_process&#x27; ).spawn( report.path, Instance.args, {
        detached: false
      });

      // Input Data
      Instance.on( &#x27;stdin.data&#x27;, function( data ) { report.process.stdin.write( data ); });

      // Output Data and Error
      report.process.stdout.on( &#x27;data&#x27;, function( data ) { Instance.emit( &#x27;process.data&#x27;, data.toString() ); });
      report.process.stdout.on( &#x27;error&#x27;, function( data ) { Instance.emit( &#x27;process.error&#x27;, data.toString() ); });

      // Set PID
      Instance.pid = report.process.pid;

      // Done
      next( !report.process.pid ? new Error( &#x27;Could now spawn process, no PID returned.&#x27; ) : null, report.process || null );

    }]
  }, function Report( error, report ) {
    process.nextTick( function() {
      Instance.emit( &#x27;node.started&#x27;, error, report );
      if( error ) { Instance.emit( &#x27;error&#x27;, error ); }
    });
  });

  // Return Instance
  return Instance;

}

/**
 * Prototyal Properties
 *
 */
Object.defineProperties( ElasticClient.prototype, {
  Document: {
    /**
     * Get / Update or create a Document
     *
     * @async
     * @chainable
     */
    value: require( &#x27;./document&#x27; ),
    configurable: false,
    enumerable: true,
    writable: false
  },
  Index: {
    /**
     * Get / Update or create an Index
     *
     * @async
     * @chainable
     */
    value: require( &#x27;./index&#x27; ),
    configurable: false,
    enumerable: true,
    writable: false
  },
  Type: {
    /**
     * Type Actions
     *
     * @async
     * @chainable
     */
    value: require( &#x27;./type&#x27; ),
    configurable: false,
    enumerable: true,
    writable: false
  },
  search: {
    /**
     * Search Documents
     *
     */
    value: function search() {
      this.client.search.apply( this, arguments );
      return this;
    },
    enumerable: true,
    writable: true
  },
  bulk: {
    /**
     * Bulk Actions
     *
     */
    value: function bulk() {
      this.client.bulk.apply( this.client, arguments );
      return this;
    },
    enumerable: true,
    writable: true
  },
  get: {
    /**
     * Get Setting
     *
     * @return {} Setting value;
     * @async
     */
    value: function get( key ) {

      // Delo hostame. Just because.
      key = key || &#x27;hostame&#x27;;

      var options = this.settings || {};

      // Helper for Hostname lookup
      if( key === &#x27;host&#x27; ) {

        if( options[ &#x27;network.publish_host&#x27; ] ) {
          key = &#x27;network.publish_host&#x27;;
        }

      }

      // Helper for port lookup
      if( key === &#x27;port&#x27; ) {

        if( options[ &#x27;http.port&#x27; ] ) {
          key = &#x27;http.port&#x27;;
        }

      }

      return options[ key ] || null;

    },
    configurable: false,
    writable: false,
    enumerable: true
  },
  set: {
    /**
     * Set an Option / Options
     *
     * @param key {String}
     * @param value {Any}
     * @return {Object} Instance.
     * @chainable
     */
    value: function set( key, value ) {

      // Create Container
      this.settings = ElasticClient.utility.defaults( this.settings, ElasticClient._defaults );

      // Set Key-Value
      if( &#x27;string&#x27; === typeof key ) {
        this.settings[ key ] = value ? value : this.settings[ key ] || undefined;
      }

      // Extend Options using Object
      if( &#x27;object&#x27; === typeof key ) {
        ElasticClient.utility.extend( this.settings, key );
      }

      // Instance
      return this;

    },
    configurable: false,
    writable: false,
    enumerable: true
  },
  stop: {
    /**
     * Shutdown Instance
     *
     * @chainable
     * @async
     */
    value: function stop() {

      // Kill the process
      process.kill( this.pid );

      // Remove from Instance Pool
      delete ElasticClient._data.instances[ this.pid ];

      // Emit Event
      this.emit( &#x27;node.stopped&#x27; );

      // Return Instance
      return this;

    },
    configurable: false,
    writable: false,
    enumerable: true
  }
})

/**
 * Constructor Properties
 *
 */
Object.defineProperties( module.exports = ElasticClient, {
  _data: {
    value: {
      defaults: {
        &#x27;http.port&#x27;: 9600,
        &#x27;network.publish_host&#x27;: &#x27;127.0.0.1&#x27;,
        &#x27;protocol&#x27;: &#x27;http&#x27;
      },
      instances: {}
    },
    enumerable: false,
    writable: true
  },
  defaults: {
    /**
     * Get / Set Defaults
     *
     * @param data
     */
    value: function defaults( data ) {

      if( data ) {
        ElasticClient._data.defaults = data;
      }

      return ElasticClient._data.defaults;

    },
    enumerable: true,
    writable: false
  },
  start: {
    /**
     * Start ElasticSearch Instance
     *
     * @extends ElasticClient
     */
    get: function() { return function( options ) { return new ElasticClient( options ); }; },
    configurable: true,
    enumerable: true
  },
  install_plugin: {
    value: function install_plugin() {},
    enumerable: true
  },
  remove_plugin: {
    value: function remove_plugin() {},
    enumerable: true
  },
  logger: {
    /**
     * Define Logger
     *
     */
    value: {
      log: function log() {},
      error: console.error,
      info: function info() {},
      debug: require( &#x27;debug&#x27; )( &#x27;elastic-client&#x27; )
    },
    configurable: true,
    writable: true,
    enumerable: true
  },
  utility: {
    value: require( &#x27;./utility&#x27; ),
    enumerable: true,
    writable: false
  },
  async: {
    value: require( &#x27;async&#x27; ),
    configurable: false,
    enumerable: false,
    writable: true
  }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
